# ============================================
# üì¶ DOCKERFILE - Simple Note App
# ============================================
# Dockerfile ‡∏Ñ‡∏∑‡∏≠ "‡∏™‡∏π‡∏ï‡∏£" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Docker Image
# ‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ñ‡∏∑‡∏≠ instruction ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á layer ‡πÉ‡∏´‡∏°‡πà

# --------------------------------------------
# Step 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Base Image
# --------------------------------------------
# FROM = ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å image ‡πÑ‡∏´‡∏ô?
# node:20-alpine = Node.js version 20 ‡∏ö‡∏ô Alpine Linux
# Alpine = Linux ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (~5MB) ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö container
FROM node:20-alpine

# --------------------------------------------
# Step 2: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Working Directory
# --------------------------------------------
# WORKDIR = ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô cd)
# ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
WORKDIR /app

# --------------------------------------------
# Step 3: Copy package.json ‡∏Å‡πà‡∏≠‡∏ô
# --------------------------------------------
# COPY <source> <destination>
# ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á copy package.json ‡πÅ‡∏¢‡∏Å?
# ‚Üí ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Docker layer caching!
# ‚Üí ‡∏ñ‡πâ‡∏≤ package.json ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô = ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á npm install ‡πÉ‡∏´‡∏°‡πà
COPY package*.json ./

# --------------------------------------------
# Step 4: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies
# --------------------------------------------
# RUN = ‡∏£‡∏±‡∏ô command ‡∏ï‡∏≠‡∏ô build image
# npm ci = clean install (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ npm install)
# --only=production = ‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á devDependencies
RUN npm ci --only=production

# --------------------------------------------
# Step 5: Copy Source Code
# --------------------------------------------
# COPY . . = copy ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å current directory
# ‡πÑ‡∏õ‡∏¢‡∏±‡∏á WORKDIR (/app)
COPY . .

# --------------------------------------------
# Step 6: ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ä‡πâ Port ‡∏≠‡∏∞‡πÑ‡∏£
# --------------------------------------------
# EXPOSE = documentation ‡∏ß‡πà‡∏≤ container ‡πÉ‡∏ä‡πâ port ‡∏≠‡∏∞‡πÑ‡∏£
# ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ publish port ‡∏à‡∏£‡∏¥‡∏á‡πÜ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ -p ‡∏ï‡∏≠‡∏ô run)
EXPOSE 3000

# --------------------------------------------
# Step 7: Command ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö start container
# --------------------------------------------
# CMD = command ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ container start
# ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö array ["executable", "param1", "param2"]
CMD ["node", "server.js"]
